<!DOCTYPE html>
<html>
<head>
    <title>Chrome 텍스트 음성 변환 - TTS TEST</title>
</head>
<body>
    <h1>텍스트를 음성으로 변환</h1>
    <input type="text" id="text-to-speak" placeholder="여기에 텍스트를 입력하세요..." />
    <br><br>
    <button onclick="addExampleText('ko')">한국어로 설정하기</button>
    <button onclick="addExampleText('en')">영어로 설정하기</button>
    <br><br>
    Rate: <input type="range" id="rate" min="0.5" max="2" value="1" step="0.1">
    <span id="rate-value">1</span>
    <br><br>
    Pitch: <input type="range" id="pitch" min="0" max="2" value="1" step="0.1">
    <span id="pitch-value">1</span>
    <br><br>
    Voice: <select id="voice-select"></select>
    <br><br>
    <button onclick="speakText()">읽어주기</button>

    <script>
        const rate = document.getElementById('rate');
        const pitch = document.getElementById('pitch');
        const voiceSelect = document.getElementById('voice-select');
        const textInput = document.getElementById('text-to-speak');
        let currentLang = 'ko'; // 기본 언어 설정

        // 속도와 음높이 값 표시 업데이트
        rate.onchange = function() {
            document.getElementById('rate-value').textContent = rate.value;
        }
        pitch.onchange = function() {
            document.getElementById('pitch-value').textContent = pitch.value;
        }

        function populateVoiceList() {
            if(typeof speechSynthesis === 'undefined') {
                return;
            }

            var voices = speechSynthesis.getVoices();
            voiceSelect.innerHTML = '';

            for(var i = 0; i < voices.length ; i++) {
                var option = document.createElement('option');
                option.textContent = voices[i].name + ' (' + voices[i].lang + ')';
                
                if(voices[i].default) {
                    option.textContent += ' -- DEFAULT';
                }

                option.setAttribute('data-lang', voices[i].lang);
                option.setAttribute('data-name', voices[i].name);
                voiceSelect.appendChild(option);
            }
        }

        populateVoiceList();
        if(typeof speechSynthesis !== 'undefined' && speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = populateVoiceList;
        }

        function speakText() {
            const text = textInput.value;
            const utterance = new SpeechSynthesisUtterance(text);
            const selectedOption = voiceSelect.selectedOptions[0].getAttribute('data-name');
            utterance.voice = speechSynthesis.getVoices().find(voice => voice.name === selectedOption);
            utterance.rate = rate.value;
            utterance.pitch = pitch.value;
            utterance.lang = currentLang;

            window.speechSynthesis.speak(utterance);
        }

        function addExampleText(lang) {
            currentLang = lang;
            if(lang === 'ko') {
                textInput.value = "안녕하세요, 이것은 텍스트를 음성으로 변환하는 예제입니다. 코드는 어떻게 읽을까요? #include<stdio.h> void main() { printf(\"Hello, World! %d\\n\", 1234); }";
            } else if(lang === 'en') {
                textInput.value = "Hello, this is an example of text to speech conversion. How will the code sounds like? #include<stdio.h> void main() { printf(\"Hello, World! %d\\n\", 1234); }";
            }
        }
    </script>
</body>
</html>
